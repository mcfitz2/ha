esphome:
  name: wordclock
  platform: ESP8266
  board: nodemcuv2

<<: !include common.yaml


# Example configuration entry
light:
  - platform: fastled_clockless
    chipset: WS2811
    pin: GPIO3
    num_leds: 60
    rgb_order: RGB
    name: "Word Clock"
    default_transition_length: 0s
    id: strip
    effects:
      - addressable_lambda:
          name: "Time"
          update_interval: 100ms
          lambda: |-
            auto time = id(sntp_time).now();
            int hours[25] = {22, 11, 19, 3, 10, 4, 20, 9, 5, 21, 8, 6, 22, 11, 19, 3, 10, 4, 20, 9, 5, 21, 8, 6, 22};
            int lookup[60][10] = {{15, -1, -1, -1, -1, -1, -1, -1, -1, -1}, {15, -1, -1, -1, -1, -1, -1, -1, -1, -1}, {15, -1, -1, -1, -1, -1, -1, -1, -1, -1}, {15, -1, -1, -1, -1, -1, -1, -1, -1, -1}, {15, -1, -1, -1, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 18, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 18, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 18, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 18, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 18, -1, -1, -1, -1, -1, -1}, {15, 1, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 1, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 1, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 1, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 1, 12, 18, -1, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 18, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 18, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 18, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 18, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 18, -1, -1, -1, -1, -1}, {15, 13, 18, -1, -1, -1, -1, -1, -1, -1}, {15, 13, 18, -1, -1, -1, -1, -1, -1, -1}, {15, 13, 18, -1, -1, -1, -1, -1, -1, -1}, {15, 13, 18, -1, -1, -1, -1, -1, -1, -1}, {15, 13, 18, -1, -1, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 2, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 2, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 2, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 2, -1, -1, -1, -1, -1}, {15, 1, 17, 12, 2, -1, -1, -1, -1, -1}, {15, 1, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 1, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 1, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 1, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 1, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 2, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 2, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 2, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 2, -1, -1, -1, -1, -1, -1}, {15, 14, 16, 2, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 0, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 2, -1, -1, -1, -1, -1, -1}, {15, 17, 12, 2, -1, -1, -1, -1, -1, -1}};

            LightColorValues val = id(strip).current_values;
            auto r = static_cast<uint8_t>(roundf(val.get_red() * 255.0f));
            auto g = static_cast<uint8_t>(roundf(val.get_green() * 255.0f));
            auto b = static_cast<uint8_t>(roundf(val.get_blue() * 255.0f));
            auto w = static_cast<uint8_t>(roundf(val.get_white() * val.get_state() * 255.0f));
            auto color = ESPColor(r, g, b, w);            it.all() = ESPColor::BLACK;
            
            int hour = time.hour;
            int minute = time.minute;
            int hour_light = hours[hour];

            if (minute > 34) {
              hour_light = hours[hour+1];
            }
            it[hour_light] = color;
            for (int i = 0; i < 10; i++) {
              int pin = lookup[minute][i];
              if (pin > 0) {
                it[pin] = color;
              }
            }     

            
time:
  - platform: sntp
    id: sntp_time

